Twitch.action("about_us#index",function(e){e(".js-staff").tipsy({gravity:e.fn.tipsy.autoNS,fade:!0,opacity:1})}),function(e,t){e.action("archive#new",function(e){initializeLegacyColumns()}),e.action("archive#show",function(e){initializeLegacyColumns(),n()}),e.action("archive#popout",function(e){n()}),e.action("archive#show",function(t){e.tracking.trackChannelPageView(PP.channel,"/broadcast/"+PP.archive_id,PP.channel_meta_game)}),e.action("archive#admin_list",function(t){t("#chanopts").popup(t("#actions")),e.user.login()===PP.channel&&t("#chanopts").hide(),t("#channel_follow").followbutton({success:function(){t("#channel_follow").hide(),t("#channel_following").show(),t("#channel_unfollow").show()},error:function(){t("#channel_following").hide(),t("#channel_follow").show(),t("#channel_unfollow").hide()}}),t("#channel_unfollow").followbutton({method:"unfollow",success:function(){t("#channel_unfollow").hide(),t("#channel_following").hide(),t("#channel_follow").show()},error:function(){t("#channel_unfollow").show(),t("#channel_following").show(),t("#channel_follow").hide()}}),t("#channel_report").click(function(e){e.preventDefault();if(!PP.login){t.login({mpSourceAction:"channel-report"});return}t("body").overlay("/"+PP.channel+"/report_form",function(e){t("#subwindow_close").click(function(e){e.preventDefault(),t(this).trigger("overlay.hide")})},{width:"400px"})}),t(".js-bookmark-delete").on("click",function(){var n=t(this).closest(".bookmark");e.api.del(t(this).data("href")),n.remove(),e.notify.alert("Bookmark deleted")})});var n=function(){var n=window.Archive=window.Archive||{};n._onPlayerPopoutRequest=function(t){e.video.archive.togglePopout(t.startTimeInSecs)},n._onAdCompanionRendered=function(e){isGoogleCompanionAd(e.provider)&&googleCompanionAdExists()};var r=e.player.parseTimeOffset(URI.parseQuery(window.location.search).t),i=r>0;n._onVideoLoaded=function(t){e.player.setSteamInfo(t.channelSteamId,t.viewerSteamId),i&&(i=!1,e.player.getPlayer().videoSeek(r))},n._onLoginRequest=function(n){t.login({mpSourceAction:"player"}),e.player.getPlayer().fullscreen(!1)},e.player.onTwitchPlayerInit(function(){var t=e.player.getPlayer();t&&(t.on("popout","Archive._onPlayerPopoutRequest"),t.on("adCompanionRendered","Archive._onAdCompanionRendered"),t.on("videoLoaded","Archive._onVideoLoaded"),t.on("loginRequest","Archive._onLoginRequest"))})}}(Twitch,jQuery),function(e,t){e.action("bookmark#show",function(e){initializeLegacyColumns(),n()});var n=function(){var n=window.Bookmark=window.Bookmark||{};n._onPlayerPopoutRequest=function(t){e.video.archive.togglePopout()},n._onAdCompanionRendered=function(e){isGoogleCompanionAd(e.provider)&&googleCompanionAdExists()};var r=e.player.parseTimeOffset(URI.parseQuery(window.location.search).t),i=r>0;n._onVideoLoaded=function(t){e.player.setSteamInfo(t.channelSteamId,t.viewerSteamId),i&&(i=!1,e.player.getPlayer().videoSeek(r))},n._onLoginRequest=function(n){t.login({mpSourceAction:"player"}),e.player.getPlayer().fullscreen(!1)},e.player.onTwitchPlayerInit(function(){var t=e.player.getPlayer();t&&(t.on("popout","Bookmark._onPlayerPopoutRequest"),t.on("adCompanionRendered","Bookmark._onAdCompanionRendered"),t.on("videoLoaded","Bookmark._onVideoLoaded"),t.on("loginRequest","Bookmark._onLoginRequested"))})}}(Twitch,jQuery),function(e,t){e.action("channel#channel",function(t){window.ChannelInfo.low_power_mode?initializeLegacyColumns({leftAlwaysCollapsed:!0}):(e.tracking.trackChannelPageView(PP.channel,"/live",PP.channel_meta_game),t("span#sub-details.action").is(":visible")&&e.tracking.mixpanel.track_with_swf("subscription_partner_channel_page_view",{is_subscribed:PP.active_channel_subscriber,ad_block:!document.getElementById("abp-test"),channel:PP.channel}),initializeLegacyColumns()),n(),NotificationsTracker.startTracking()});var n=function(){var n=window.Channel=window.Channel||{};n._onPlayerViewerCount=function(e){setChannelViewerCount(e.count,e.channel)},n._onPlayerTosViolation=function(e){window.location=window.location},n._onPlayerPopoutRequest=function(e){toggle_live_player_popout(e.channel)},n._onAdCompanionRendered=function(e){isGoogleCompanionAd(e.provider)&&googleCompanionAdExists()},n._onStreamLoaded=function(t){e.player.setSteamInfo(t.channelSteamId,t.viewerSteamId)},n._onLoginRequest=function(n){t.login({mpSourceAction:"player"}),e.player.getPlayer().fullscreen(!1)},e.player.onTwitchPlayerInit(function(){var t=e.player.getPlayer();t&&(t.on("viewerCount","Channel._onPlayerViewerCount"),t.on("tosViolation","Channel._onPlayerTosViolation"),t.on("popout","Channel._onPlayerPopoutRequest"),t.on("adCompanionRendered","Channel._onAdCompanionRendered"),t.on("streamLoaded","Channel._onStreamLoaded"),t.on("loginRequest","Channel._onLoginRequest"))})};e.action("channel#edit",function(e){initializeLegacyColumns()})}(Twitch,jQuery),Twitch.action("chat#embed",function(e){document.domain="twitch.tv";var t=function(){e("#chat_lines").css("max-height",e(window).height()-e("#speak").outerHeight(!0)-4+"px"),e("#chat_lines").height(e(window).height()-e("speak").outerHeight(!0)-4+"px"),e(window).width()>299&&e(window).height()>334?e("#small_notice").hide():e("#small_notice").show()};t();if(e("body").hasClass("popout_chat")){var n=_.debounce(t,50);e(window).resize(n)}}),Twitch.action("errors#handle404",function(e){e.fn.typewriter=function(){return this.each(function(){var t=e(this),n=t.text(),r=0,i=0;t.text("");var s=setInterval(function(){r++;while((i=n.charCodeAt(r))<48||i>122)r++;t.text(n.substring(0,r)),r>=n.length&&clearInterval(s)},120)}),this},e(".js-typewriter").typewriter()}),Twitch.action("front_page#front_page",function(e){var t=function(){Twitch.storage.set("mp:source","front_page"),Twitch.storage.set("mp:channel-discovery-index",e(".nav .active").index())};e(".js-carousel-nav").tipsy({gravity:"s"}),e("#signup .birthday_fields select").dropdownify(),e("body").on("click",".js-channel_discovery_link, .js-channel_discovery_desc a",t),e(".game").each(function(t,n){var r={game:e(n).data("game"),index:t,location:"front_page",promoted:e(n).hasClass("promoted-game").toString()};e(n).click(Twitch.tracking.mixpanel.setGameClickVars(r))}),e(".nav a").on("click",function(t){t.preventDefault(),t.stopPropagation(),e(this).data().channel!==undefined&&e.get("/front_page/live_player",{channel:e(this).data().channel}).done(function(t){e(".focus").html(t)});if(e(this).data().game!==undefined){var n="http://ttv-backgroundart.s3.amazonaws.com/",r=n+encodeURI(e(this).data().game)+".jpg";e("#carousel_background img").attr("src",r)}var i=e(this).parent("li").index()+1;e(".items .active").fadeOut("fast",function(){e(this).removeClass("active"),e(this).parent("ul").children("li:nth-child("+i+")").fadeIn("fast"),e(this).parent("ul").children("li:nth-child("+i+")").addClass("active")}),e(".nav .active").removeClass("active"),e(".nav li:nth-child("+i+")").addClass("active")}),Twitch.api.get("videos/top",{limit:6}).done(function(t){_.forEach(t.videos,function(t){var n=ich.fp_video(_.extend(t,{channel:t.channel,game:t.game,recordedAt:function(){return e.timeago(t.recorded_at)},lengthAsClock:function(){return Twitch.display.lengthAsClock(t.length)},commatizedViews:function(){return Twitch.display.commatize(t.views)}}));e("#highlights").append(n)})}),Twitch.api.get("streams",{limit:6,sce_platform:"PS4"},{version:3}).done(function(t){_.forEach(t.streams,function(t){var n=ich.fp_psFour(_.extend(t,{channel:t.channel,game:t.game}));e("#psFour-channels").append(n)})}),Twitch.ads.enabled()&&(Twitch.ads.dfp_enabled()&&(googletag.enableServices(),Twitch.ads.registerGoogleTags()),Twitch.ads.synchronous_load()||Twitch.ads.fetchAll()),mobileNotification(),euCookieNotification()}),Twitch.action("chapter#show",function(e){initializeLegacyColumns(),Twitch.tracking.trackChannelPageView(PP.channel,"/highlight/"+PP.chapter_id,PP.channel_meta_game)}),function(e,t){e.action("message#list",function(e){var t=function(t,n){t.preventDefault(),e("#message-list input[type=checkbox]").prop("checked",n)};e("#select_all").on("click",function(e){t(e,!0)}),e("#select_none").on("click",function(e){t(e,!1)});var r=function(t){e("#ev").val(t)};e(".batch_btn").on("click",function(){r(e(this).attr("id"))}),e(".message_action.block").each(function(e,t){n(t)})}),e.action("message#show",function(e){e(".message_action.block").each(function(e,t){n(t)})});var n=function(e){t(e).on("click",function(n){n.stopPropagation(),n.preventDefault(),t.ajax({url:t(e).attr("href"),type:"POST",headers:{"X-Http-Method-Override":t(e).data("methodOverride"),"X-CSRF-Token":t("meta[name='csrf-token']").attr("content")}}).done(function(e){var n=t(e).data("targetUserId");t(".js-"+n).each(function(n,r){t(r).attr("href",t(e).attr("href")),t(r).text(t(e).text()),t(r).data(t(e).data())})})})}}(Twitch,jQuery),Twitch.action("user#reset_password_form",function(e){e(function(){var t=e(".js-reset-form");PasswordStrength.watch(t.find("[name=password]"),t.find("[name=score]"),t.find(".js-password-strength")),t.on("submit",function(){var t=e("#password").val();if(t!==e("#password_confirmation").val())return Twitch.notify.error(i18n("Your passwords do not match.")),!1;if(t.length<5)return Twitch.notify.error(i18n("Your password must be at least 5 characters.")),!1})})}),Twitch.action("search#search",function(e){var t=[{name:"users",count:3},{name:"live",count:3},{name:"broadcasts",count:3}],n=function(e){e=parseInt(e,10);var t=Math.floor(e/3600),n=Math.floor((e-t*3600)/60),r=e-t*3600-n*60;return t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r),t+":"+n+":"+r},r=function(t,r){var i,s="search-"+t;if(ich[s])return s==="search-broadcasts"&&r.length&&(r.length=n(r.length)),i=ich[s](r),e("time",i).timeago().attr("title",function(t){return(new Date(Date.parse(e(this).attr("datetime")))).toLocaleDateString()}),i},i=function(n){var i=this,s;s=Object.keys(n.records).some(function(e){return n.records[e].length>0}),s||e(".js-no-results").show(),t.forEach(function(e){var t,s;if(n.records[e.name].length>0){t=n.records[e.name].splice(0,e.count);for(var o=0,u=t.length;o<u;o++)s=r(e.name,t[o]),s.addClass("top-result").appendTo("#st-results-container"),i.registerResult(s,t[o])}}),e(".js-results").removeClass("loading").spin(!1)},s={top:100},o=function(t,n){e(".js-no-results").hide(),e(".js-results").addClass("loading").spin(s)},u=new Date(+(new Date)-186e4),a=e("input#st-search-input");a.swiftypeSearch({resultContainingElement:"#st-results-container",engineKey:"9NXQEpmQPwBEz43TM592",renderFunction:r,preRenderFunction:i,loadingFunction:o,sortField:function(){var e=(new URI).query(!0).sort;if(e==="views")return{broadcasts:"views"};return},searchFields:{live:["name","login","status","game^2"],users:["login","name"],broadcasts:["title","description","game^2","user"]},fetchFields:{live:["thumbnail","profileImage","status","title","game","name","path","profilePath"],users:["name","path","bio","views","followers","profilePath","profileImage"],broadcasts:["thumbnail","title","description","game","user","path","length","views","startTime","profileImage","profilePath","gamePath"]},functionalBoosts:{live:{followers:"logarithmic"},users:{followers:"logarithmic"},broadcasts:{views:"logarithmic"}},filters:{live:{updated_at:"["+u.toISOString()+" TO *]"}}});var f=(new URI).query(!0).query;e("input#query").val(f),a.val(f).submit();var l=function(t){window.history&&window.history.pushState?(history.pushState(null,null,t),e(window).trigger("hashchange")):document.location=t};e("#sorting").on("click",".js-relevance",function(t){t.preventDefault(),e(this).addClass("selected").siblings().removeClass("selected");var n=(new URI).removeQuery("sort");l(n)}).on("click",".js-views",function(t){t.preventDefault(),e(this).addClass("selected").siblings().removeClass("selected");var n=(new URI).addQuery("sort","views");l(n)}),Twitch.ads.enabled()&&Twitch.ads.dfp_enabled()&&(googletag.enableServices(),Twitch.ads.registerGoogleTags())}),Twitch.action("teams#show",function(e){function n(t){e.get(t).done(function(t){e("#team_member_list").replaceWith(t);var n=e("#live_player .swf_container").data("channel");e("#channel_"+n).addClass("js-playing"),e("#streams_spinner").hide()})}var t=window.Team=window.Team||{};t._onPlayerViewerCount=function(e){setChannelViewerCount(e.count,e.channel)},t._onPlayerPopoutRequest=function(e){toggle_live_player_popout(e.channel)},t._onLoginRequest=function(t){e.login({mpSourceAction:"player"}),Twitch.player.getPlayer().fullscreen(!1)},Twitch.player.onTwitchPlayerInit(function(){var e=Twitch.player.getPlayer();e&&(e.on("viewerCount","Team._onPlayerViewerCount"),e.on("popout","Team._onPlayerPopoutRequest"),e.on("loginRequest","Team._onLoginRequest"))}),e("#team_member_list .page_data a").live("click",function(t){t.preventDefault(),e("#streams_spinner").show(),n(e(this).attr("href"))}),e("#team_member_list").length>0&&setInterval(function(){n(window.location.pathname+"/live_member_list?page="+(e("#team_member_list").attr("page")||"1"))},25e3),e(".tab").tabify(),e("#team_follow").tipsy({gravity:"s"}),e(".multi_select .button").tipsy({gravity:"s"}),e("#memberopts").popup(e("#member_actions"));var r=function(t){e("#subwindow_close").click(function(t){t.preventDefault(),e(this).trigger("overlay.hide")}),e("#team_follow_submit").click(function(t){t.preventDefault(),e.post(e("#team_follow_form").attr("action"),e("#team_follow_form").serialize()).success(function(t){e("#teams_notice").html("Selected members followed."),e(".alert").removeClass("error").addClass("success").show(),e("#team_follow_table").trigger("overlay.hide")})})};e("#team_follow").click(function(t){t.preventDefault();if(!PP.login){e.login({mpSourceAction:"team-follow-button"});return}e(".alert").hide(),e("body").overlay(e("#team_follow").attr("href"),r,{width:"400px",destroyOnHide:!1})}),e("#team_follow_table .page_data a").live("click",function(t){return e("#team_follow_spinner").show(),e.get(e(this).attr("href"),{check_all:e("#user_follow_all").is(":checked")}).success(function(t){e("#team_follow_table").replaceWith(t),i(),e("#team_follow_spinner").hide(),r()}),!1});var i=function(){e("#user_follow_all").is(":checked")?(e("#team_follow_table .selector input").prop("checked",!0),e("#team_follow_table .selector input").prop("disabled",!0)):e("#team_follow_table .selector input").prop("disabled",!1)};e("#user_follow_all").live("click",i);var s=function(){e(".js-share").popup(e(".js-share-popup"),{side:"left",above:!0})};s(),e(".live.member, .live.member a").on("click",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).closest(".live.member");e.get("/team/switch_live_player"+n.find("a").attr("href")).done(function(t){e(".js-playing").removeClass("js-playing"),n.addClass("js-playing"),e(".js-share-popup").remove(),e("#live_player").replaceWith(t),e(".js-share-popup").appendTo(e("body")),s()})})}),Twitch.action("tokens#show",function(e){var t=i18n("Error encountered when sending SMS");e(".js-request-sms").on("ajax:error",function(e,n,r,i){Twitch.notify.error(t)}).on("ajax:success",function(e,n,r,i){n.success?Twitch.notify(i18n("SMS sent to your registered phone")):Twitch.notify.error(t)}),e(".js-request-sms").click(function(t){t.preventDefault(),t.target===this&&e('a[data-remote="true"]',this).click()})}),function(e){e(document).ready(function(){Twitch.run(e("body").attr("data-page"))})}(jQuery);